SPECIAL SECTION ON INTELLIGENT SYSTEMS FOR THE INTERNET OF THINGS Received August 31, 2017, accepted October 5, 2017, date of publication October 24, 2017, date of current version February 14, 2018. Digital Object Identifier 10.1109/ACCESS.2017.2765702 IoT-Based Wireless Polysomnography Intelligent System for Sleep Monitoring CHIN-TENG LIN1, (Fellow, IEEE), MUKESH PRASAD 1, CHIA-HSIN CHUNG2, DEEPAK PUTHAL 3, HESHAM EL-SAYED 4, SHARMI SANKAR5, YU-KAI WANG1, JAGENDRA SINGH6, AND ARUN KUMAR SANGAIAH7 1Centre for Arti cial Intelligence, School of Software, FEIT, University of Technology Sydney, Ultimo, NSW 2007, Australia 2Institute of Computer Science and Engineering, National Chiao Tung University, Hsinchu 300, Taiwan 3School of Electrical and Data Engineering, FEIT, University of Technology Sydney, Ultimo, NSW 2007, Australia 4College of Information Technology, United Arab Emirates University, Al Ain 17172, United Arab Emirates 5Department of Information Technology, Ibri College of Applied Sciences (MoHE), Ibri 112, Sultanate of Oman 6Department of Computer Science, Indraprastha Engineering College, Ghaziabad 201010, India 7School of Computing Science and Engineering, VIT University, Tamil Nadu 632014, India Corresponding author: Mukesh Prasad (mukesh.nctu@gmail.com) This work was supported in part by the Australian Research Council under Grant DP150101645, in part by Central for Arti cial Intelligence, UTS, Australia, in part by the U.S. Army Research Laboratory under Grant W911NF-10-2-0022 and Grant W911NF-10-D-0002/TO 0023, and in part by the Roadway, Transportation, and Traf c Safety Research Center, United Arab Emirates University, under Grant 31R058. ABSTRACT Polysomnography (PSG) is considered the gold standard in the diagnosis of obstructive sleep apnea (OSA). The diagnosis of OSA requires an overnight sleep experiment in a laboratory. However, due to limitations in relation to the number of labs and beds available, patients often need to wait a long time before being diagnosed and eventually treated. In addition, the unfamiliar environment and restricted mobility when a patient is being tested with a polysomnogram may disturb their sleep, resulting in an incomplete or corrupted test. Therefore, it is posed that a PSG conducted in the patient s home would be more reliable and convenient. The Internet of Things (IoT) plays a vital role in the e-Health system. In this paper, we implement an IoT-based wireless polysomnography system for sleep monitoring, which utilizes a battery- powered, miniature, wireless, portable, and multipurpose recorder. A Java-based PSG recording program in the personal computer is designed to save several bio-signals and transfer them into the European data format. These PSG records can be used to determine a patient s sleep stages and diagnose OSA. This system is portable, lightweight, and has low power-consumption. To demonstrate the feasibility of the proposed PSG system, a comparison was made between the standard PSG-Alice 5 Diagnostic Sleep System and the proposed system. Several healthy volunteer patients participated in the PSG experiment and were monitored by both the standard PSG-Alice 5 Diagnostic Sleep System and the proposed system simultaneously, under the supervision of specialists at the Sleep Laboratory in Taipei Veteran General Hospital. A comparison of the results of the time-domain waveform and sleep stage of the two systems shows that the proposed system is reliable and can be applied in practice. The proposed system can facilitate the long-term tracing and research of personal sleep monitoring at home. INDEX TERMS Polysomnography (PSG), JAVA, Internet of Things, wireless, sleep monitoring. I. INTRODUCTION The Internet of Things (IoT) is a promising technology for smart applications, such as health monitoring and online data processing [48] [50]. However, the major concern about IoT deployment is data security [51] and energy ef ciency [52]. To address this issue, we focus on developing an IoT framework-based sleep monitoring system. Sleep is a natural state of bodily rest observed in humans and other animals. A sleep disorder is a medical disorder of the sleep patterns of a person or animal. Obstructive sleep apnea (OSA) is the most common type of sleep-disordered breathing. The term sleep disordered breathing is commonly used in the US to describe the full range of breathing problems during sleep in which not enough air reaches the lungs (hypopnea and apnea). VOLUME 6, 2018 2169-3536 2017 IEEE. Translations and content mining are permitted for academic research only. Personal use is also permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information. 405 C.-T. Lin et al.: IoT-Based Wireless PSG Intelligent System for Sleep Monitoring Sleep disordered breathing is associated with an increased risk of cardiovascular disease, stroke, high blood pressure, arrhythmias, diabetes, and accidents [1] [4]. Some sleep disorders are serious enough to interfere with normal physical, mental and emotional functioning. People who complain of daytime fatigue or sleepiness may be suffering from interrupted sleep, which results in daytime sleepiness and an inability to concentrate, which may lead to accidents [5], hence it has a direct impact on the patient s quality of life. In recent years, in Europe, America, and Japan, sleep disorders have become one of the main focuses of public safety. Obstructive sleep apnea syndrome (OSAS) [44] as evalu- ated from PSG data was scored by clinical experts using stan- dard procedures and criteria [6]. Sleep disorders are a major public health problem, affecting up to 5% of the world s pop- ulation [6], with levels reaching as high as 4% for men, 2% for women, and 3% for children [7]. The American Association of Sleep Medicine [AASM] published initial practice param- eters regarding the use of Portable Monitor (PM) devices in the assessment of OSA in 1994 [8]. Many studies have been carried out for OSAS screening in an attempt to reduce PSG cost and complexity. Different techniques have been proposed, oximetry-based screening being one of the most widely suggested for both the adult and pediatric population. Although these methods have high sensitivity, they tend to have very low speci city [9]. The ASSM sleep apnea evalu- ation studies based on the number of channels or signals that the monitor employed, from level I to level IV. A minimum of 6 hours of recording time was recommended when using any of the con gurations. A sleep lab may be in a hospital, a free-standing medical of ce, or in a hotel. A sleep technician should always be in attendance and is responsible for attaching the electrodes to the patient and monitoring the patient during the study. After the test is completed, a scorer analyzes the data by reviewing the study in 30 second epochs [11]. The objective of the meta-analysis in [12] is to compare the accuracy of home sleep studies with laboratory polysomnog- raphy in the diagnosis of OSA. Home sleep studies provide similar diagnostic information to laboratory polysomnogra- phy in the evaluation of sleep-disordered breathing but may underestimate the severity of sleep apnea. The lower cost of home sleep studies makes it a viable screening tool for patients with suspected OSA; however, these lower costs are partially offset by the higher rate of inadequate examinations. The primary end point examined is the ability of PM devices to con rm or rule out disease. The AASM guide- lines [15] allow for the use of PM devices under certain conditions. These include the lack of available polysomnog- raphy for patients with severe clinical symptoms consistent with OSA, the inability of the patient to be studied in a laboratory, or to evaluate the response of a patient who has already undergone traditional in-laboratory polysomnog- raphy to therapy. A number of limited-channel, in-home devices for the diagnosis of OSA have been described in [10], [13], [14], [16] [22], and [45]; however, as a group they have not been recommended in the published practice parameters for in-home unattended studies [15], [23]. The primary reason given is the lack of acceptable validation stud- ies. However, when a scheme classifying sleep apnea diag- nostic systems into levels of complexity is used to simplify comparisons [23], it has the effect of obscuring the validity of individual devices with acceptable validation studies. However, there are several limitations of PM devices that must be considered as well. These include the inherent lack of an attendant during the study, which may potentially affect data quality. In addition, the most widely used applications of PM technology do not have electroencephalogram (EEG) channels and are unable to assess the sleep architecture of staging. This inability does not allow for the computation of the apnea-hypopnea index (AHI) because total sleep time cannot be calculated. While clinicians have increasingly turned their attention to this syndrome, and referrals to sleep clinics for diagnostic evaluations have increased dramatically, the infrastructure to support them has not [24]. The report stated that simpler and less expensive diagnostic tests as well as simpler prescreening tests prior to full-channel PSG are needed [25]. Time is of the essence: as many as 82% of men and 93% of women with moderate-to-severe sleep apnea have not received a diagnosis, as estimated by data from the Wisconsin Sleep Cohort study [26]. Patients may have sleep apnea for up to 7 years before coming to medical attention and they may wait up to an additional 8 months before seeing a sleep specialist [27]. The recently recognized adverse consequences of sleep apnea, along with ongoing therapeutic advances, have height- ened the urgency for expeditious diagnosis and treatment. The high prevalence of sleep-related breathing disorders has high- lighted the limitations in patient accessibility to diagnostic and therapeutic services. In addition, as the need for studies has increased, less costly but comparable ef cacious alterna- tives to laboratory-based polysomnography (PSG) are being sought in response to current economic imperatives. Finally, home studies may provide a more realistic appraisal of night- time pathology than can be obtained in the laboratory setting. Because of these and other considerations, portable sys- tems to assess sleep apnea have been developed for use in settings outside the sleep laboratory. Utilizing a con- ventional wireless ambulatory recorder, we have developed a portable multipurpose recorder which can store several biosignals simultaneously. In this study, the EEG, EOG (electrocardiogram), EMG (electromyography), EKG (elec- trocardiography) and air ow are recorded during sleep using monitoring/recording software designed by Java. Data are written in a binary le following the standard European Data Format (EDF), a standard le format designed for the exchange and storage of medical time series [28]. The exchange format can be imported to other software to anal- yse sleep disorder and the sleep stages can be scored by a specialist. 406 VOLUME 6, 2018 C.-T. Lin et al.: IoT-Based Wireless PSG Intelligent System for Sleep Monitoring The rest of the paper is organized as follows: Section II describes the basic studies, Sections III and IV elaborate the hardware framework of portable bio-signal acquisition systems and the software framework of portable bio-signal acquisition systems, respectively. Section V presents the experimental results and nally, the conclusion is drawn in Section VI. II. BASIC STUDIES The purpose of this research is to develop a portable wireless PSG system for sleep monitoring. In order to do this, a system to acquire and monitor/record the bio-signals in EDF format is needed, where the exchange format can be imported by other analysis software to score the sleep stage; so, it was divided into two parts: one is how to get the data for signal processing in the experimental environment and the other is to determine what this bio-signal means in scoring the sleep stage. The diagrammatic overview of the system is shown in Fig. 1. FIGURE 1. Diagram of wireless polysomnography system, A. BIO-SIGNALS A polysomnogram will typically record a minimum of eleven channels requiring a minimum of 22 wire attachments to the patient. Two channels are for the EEG [30], [46], one or two measure air ow, one is for chin movements, one or more for leg movements, two for eye movements (EOG), one for heart rate and rhythm, one for oxygen saturation and one each for the belts which measure chest wall movement and upper abdominal wall movement [47]. Wires for each channel of recorded data lead from the patient and converge into a central box, which in turn is connected to a computer system for recording, storing and displaying the data. During sleep, the computer monitor can display multiple channels continuously. In addition, most labs have a small video camera in the room so the technician can observe the patient visually from an adjacent room. The different types of electrical potentials are listed in Table 1 [29]. We describe the different biosignals of the electrode position and recorded signal, for example: this patient is wired up for an overnight sleep study (polysomnogram) [43]. B. SLEEP STAGE According to the AASM Manual for Sleep Scoring [11], con- sidered the world-wide standard in the medical community, sleep staging relies on three fundamental biopotentials: the brain wave activity measured by an EEG, the eye movement recorded via an EOG and the muscular tone measured by an EMG. The sleep structure is represented in a dedicated TABLE 1. Medical and physiological parameters [29]. FIGURE 2. Sleep stage patterns [41]. graph, called a hypnogram, which represents the course of the sleep stages of the patient overnight (see Fig. 2), and provides the clinician with relevant information for the diagnosis of sleep disorders. Sleep proceeds in cycles of REM and NREM, the order normally being N1 N2 N3 N2 REM. There is a greater amount of deep sleep (stage N3) early in the night, while the proportion of REM sleep increases later in the night and just before natural awakening. The stages of sleep were rst described in 1937 by Alfred Lee Loomis and coworkers, who separated the different EEG features of sleep into ve levels (A to E), which represent the spectrum of wakefulness to deep sleep [31], [33]. In 1953, REM sleep was found to be a distinct stage, whereupon William Dement and Nathaniel Kleitman reclassi ed sleep into four NREM stages and REM [34]. The staging crite- ria were standardized in 1968 by Allan Rechtschaffen and Anthony Kales in the R&K Sleep Scoring Manual [35]. In the R&K standard, NREM sleep was divided into four stages, with slow-wave sleep comprising stages 3 and 4. In stage 3, delta waves made up less than 50% of the total wave patterns, while they made up more than 50% in stage 4. Furthermore, REM sleep was sometimes referred to as stage 5. In 2004, the AASM commissioned the AASM Visual Scor- ing Task Force to review the R&K scoring system, which culminated in several changes, the most signi cant being the combination of stages 3 and 4 into Stage N3. This was pub- lished in 2007 as the AASM Manual for the Scoring of Sleep and Associated Events [11], [32]. Arousals and respiratory, cardiac, and movement events were also added [36], [37]. Sleep stages were scored in 30s sequential epochs com- mencing from the beginning of the study and a stage was VOLUME 6, 2018 407 C.-T. Lin et al.: IoT-Based Wireless PSG Intelligent System for Sleep Monitoring assigned to each epoch. If two of more stages coexist during a single epoch, the stage comprising the largest portion of the epoch [11] was assigned to Sl. C. SCORING APNEAS The amplitude criteria for scoring an apnea are at least a 90% drop or more in the thermal sensor excursion, lasting for at least 10s. It is labeled obstructive if the efforts (respiratory and abdominal continue) are seen; it is called central if none of these excursions are seen, and mixed, if this effort is resumed toward the end of the period of apnea. D. SCORING HYPOPNEA The duration of hypopnea should be at least 10s. The drop in the amplitude of the nasal transducer is > 30%, with a 4% drop in saturation of > 50 %, with a 3% drop in saturation. E. EUROPEAN DATA FORMAT The European Data Format (EDF) [28] is a simple and exible format for the exchange and storage of multichan- nel biological and physical signals. It was developed by several European medical engineers who rst met at the 1987 international Sleep Congress in Copenhagen. A data le consists of a header record followed by data records. The variable-length header record identi es the patient and speci es the technical characteristics of the recorded signals. The data records contain consecutive xed-duration epochs of the polygraphic recording. There is a detailed digital format of the header record (upper block, ASCII s only) and of each subsequent data record (lower block integers only). Note that each one of the ns signals is characterized separately in the header. Following the header record, each of the subsequent data records contains duration seconds of ns signals, with each signal being represented by the speci ed (in the header) number of samples. In order to reduce data size and adapt to commonly used software for the acquisition, processing and graphical display of polygraphic signals, each sample value is represented as a 2-byte integer in 2 s complement format. III. HARDWARE FRAMEWORK OF THE PORTABLE BIO-SIGNAL ACQUISITION SYSTEM In our experimental environment, the user wears a portable acquisition system developed to continually obtain multiple bio-signals during the period of overnight sleep. This portable acquisition system is a battery-powered and wearable mod- ule. It is easy to set up and is comfortable for the users. First, multiple bio-signals are continually measured by our portable acquisition module. After amplifying tiny multiple bio-signals, all noise except the frequency band of multiple bio-signals is removed by the lters in our portable acquisi- tion module. Then, ltered multiple bio-signals are digitized by the analog-to-digital converter, and are transited to the PC via Bluetooth. The PC-based software is development by JAVA to receive digitalized raw data from our portable acquisition module to decode raw data, to display raw data in real-time and to save raw data in standard format. The saved records can be transmitted to a hospital via the network, and can be analyzed by autoscoring software and validated by the clinician. An analysis of the autoscoring software and the validation of the clinician simplify the PSG test, and allow the sleep monitoring of patients to be conducted in their homes. Our portable PSG system is easier and more comfortable for the patient and enables more familiar and normal sleep habits. The portable biosignal acquisition unit comprises four parts: (1) front-end lter circuit, (2) analog to digital con- verter and digital controller, (3) power management circuit and (4) wireless transmission. A diagram of the portable biosignal acquisition unit for various kinds of biosensors as shown in Fig. 3, which indicates the voltage and frequency ranges of some common biopotential signals [38]. FIGURE 3. Diagram of portable biosignal acquisition unit. FIGURE 4. The hardware of the portable biosignal acquisition unit. Fig. 4 shows the hardware of the portable biosignal acqui- sition system. There are twelve leads in our portable EEG system, six ExG inputs, two air ow inputs, three references, and one virtual ground of the front-end analog circuit. The speci cations of the portable biosignal acquisition unit are listed in Table 2. IV. SOFTWARE FRAMEWORK OF THE PORTABLE BIO-SIGNAL ACQUISITION SYSTEM In the proposed PSG system, a microprocessor (TI MSP430) was used to perform bio-signal data acquisition in the bio-signal acquisition module and transmit digitized bio- signals wirelessly to the PC via Bluetooth [40]. The software framework of the whole system is shown in Fig.5. It com- prises two parts: the rmware in MSP 430 and the software in the PC. 408 VOLUME 6, 2018 C.-T. Lin et al.: IoT-Based Wireless PSG Intelligent System for Sleep Monitoring TABLE 2. The specifications of the portable biosignal acquisition unit. FIGURE 5. Diagram of software framework. TABLE 3. The parameters of the EDF header. A. SOFTWARE IN THE PERSONAL COMPUTER We developed a Graphics User Interface (GUI) using the Java Development Kit (JDK) 6 to monitor and record the bio- signals as shown in Fig. 14. Where, a function menu is in the upper left corner, a system information board is in middle left side, a real-time display of bio-signal waveform is in right side and a form for user information is in bottom of the window. The software of the proposed PSG system is handled by ve modules which are explained in the following sections. B. USER INPUT MODULE According to the EDF le format described in Table 3, in the header of EDF, there are two elds which need input: local subject identi cation and local recording identi cation. We use KeyListener to handle and check the user input. FIGURE 6. Flow chart of firmware in MSP430. The date and time elds are provided by the system. The time eld is handled by a thread; it stops when the user pushes the button start recording and it continues when the user pushes the button stop recording . C. DEVICE DISCOVERY MODULE A PC with a Bluetooth USB dongle was used as the local device and our probable bi-signal acquisition module was used as the remote device. When the user pushes the button Begin receiving biosignal , the local device discovery pro- cedure starts to search the remote device as shown as Fig. 7. The Discovery Listener interface allows an application to receive the device discovery and service discovery events. This interface comprises four methods, two for discovering devices and two for discovering services. The speci cation of Java TM APIs for Bluetooth is described in JSR 82. FIGURE 7. Procedure of discovery listener. D. INPUT STREAM MODULE After discovering the remote device, we used the Bluetooth protocol Radio Frequency Communication (RFCOMM) to exchange data between the local and remote devices. The RFCOMM is on top of the L2CAP protocol, providing emu- lated RS-232 serial ports. We obtained the Uniform Resource VOLUME 6, 2018 409 C.-T. Lin et al.: IoT-Based Wireless PSG Intelligent System for Sleep Monitoring FIGURE 8. Record data in text format. Locator (URL) of the remote Bluetooth and opened the con- nection between the local device and the remote device, and exchanged data based on the RFCOMM protocol. The Java.io package was used to receive data from our portable PSG device. This package has an InputStream and OutputStream. Java InputStream is de ned for reading the stream, byte stream and array of the byte stream. Fig. 8 shows that the data format of the software in PC coincides with the rmware in MSP430. The rst column of the header is 0xFF and second column is 0x62, the rest is the data of each channel. FF is the identi er for channel data, 62 is representative of the sample rate and the number of channels. After receiving, the data of each channel was rebuilt as follows: Channelx = Channelx low byte + Channelx high byte 256 E. DISPLAY MODULE In bio-signal recording, the scientist and clinician need to know not only the bio-signal waveforms but also their ampli- tudes. Therefore, we restore the signal and mark the ampli- tude of bio-signals and the bio-signal waveform is circular, drawn using Graphics 2D on a Java JPanel, the panel shows in right side of the windows in Fig. 14. The sampling rate of the screen display was down-sampled to 128 Hz, and each page shows ve-second bio-signals. F. DATA RECORD MODULE When the user pushes the start recording button, the data is recorded in two formats using the Java.io package. Form 1 is recorded in text form, as shown in Fig. 8. Form 2 is an EDF le format as shown in Table 3, where there are four elds in the EDF header, and these four extreme values specify the offset and ampli cation of the signal, the parameter of amplitude and offset is (phy_max - phy_min) / (dig_max - dig_min). In the data records, each sample value is represented as a 2-byte integer in 2 s complement and a little endian format. Depending on the feature of the EDF le format, we buffered the incoming data until a second amount of data was collected. Next, we wrote to the EDF le when every second amount of data was collected. When the user pushes the stop recording button, the Number of data records eld of the header will be updated. The owchart of the program and successfully EDF saved le are shown in Fig. 9 and 11, respectively. V. RESULTS To assess the feasibility of our proposed PSG system in this study, we used two settings to verify the system. One is the simulated signal test and the other is preliminary test on healthy volunteer patients under the supervision of specialist at Sleep laboratory of Taipei Veteran General Hospital. FIGURE 9. Recording procedure of the text file and EDF. FIGURE 10. Simulation data in EDF format and browse by EDF browser [42]. The reference system is a complete PSG system designed by Philips Respironics. According to the comparison of the difference between the aforementioned two system in the time domain, our proposed system can perform well and can be applied in practice. A more quantitative comparison is per- formed by looking at the duration of each sleep stage and the percentage of each sleep stage over the night. Relative errors in stage duration show very good results for sleep (Stage 1), Stage W and the REM stage. A. VERIFICATION OF SIMULATION SIGNALS The feasibility of the proposed PSG system is discussed in this section. In order to verify the validity and eval- uate the performance of our PSG system for various kinds of bio-signals, rst sin waves with difference fre- quency (1Hz B5Hz B15Hz and 20Hz) and 100 V vibra- tion amplitude generated by a function generator were used to simulate the signal test. First, the simulated signal was measured by the proposed PSG system, digitized, and then transmitted to the PC via Bluetooth. A Java program was designed to receive signals transmitted from our PSG system. Fig. 11 shows a comparison of FFT between the simulated signals obtained by our PSG system and the reference sig- nals generated by MATLAB. Here, sin waves generated by MATLAB were used as reference signals. Both simulated signals and reference signals were in 1, 5, 15, and 20 Hz respectively. The results show that the frequency properties of the simulated signals obtained by our PSG system were accurate and matched those of the reference signals. 410 VOLUME 6, 2018 C.-T. Lin et al.: IoT-Based Wireless PSG Intelligent System for Sleep Monitoring FIGURE 11. Comparison of FFT between simulated signals obtained by our PSG system and the reference signals generated by MATLAB for 1, 5, 15, and 20 Hz sin waves. FIGURE 12. Diagram of bio-signal processing for system verification. B. COMPARISON BETWEEN OUR PROPOSED SYSTEM AND THE REFERENCE SYSTEM We recorded EEG (O2-M1, C4-M1), EOG, EMG, EKG and air ow at the same time. The Alice 5 Diagnostic Sleep System sampling rate is 200Hz and our proposed system sampling rate is 256Hz. After recording, the records of the two systems were adjusted to the same sampling rate, and restored the original signals. A comparison of the time domain signal and the sleep stage was used to verify the system. Fig. 12 shows a diagram of the bio-signals processing for system veri cation. Fig. 13 shows the electrodes disposal of the two systems. C. EXPERIMENT OUTPUT A total three subjects wore the two systems (Alice 5 diag- nostic sleep system and the proposed system) at the same time, and their physiological signals were simultaneously measured during sleep. After the test, we imported the EDF FIGURE 13. Electrodes disposal of the two systems. FIGURE 14. PC-based recording/monitoring user interface. FIGURE 15. Stage W: note the eye movements with high chin tone, 30-s epoch. le to Alice Sleepware and the clinician was asked to score the sleep stage. Fig. 15 shows the variations in the subject s bio-signals during the awake sleep stage. According to the 2007 AASM standards, there are ve different stages of sleep, namely Stage W (Wakefulness), Stage N1 (NREM1), Stage N2 (NREM2), Stage N3 (NREM3) and Stage R (REM). After completing the sleep experiment, a scorer analyzes these data by reviewing 30-second epochs to make up a hypnogram for overnight sleep and to summarize sleep structure. The top signals as shown in Fig. 15 are the sleep stage of Alice Sleepware and other 30-second physiological signals are shown in the main window. These physiological signals listed from top to bottom respectively are EOG-left, EOG-right, EEG(C4-M1), EEG(O2-M1), EMG, Air ow and ECG. In order to verify the validity of the bio-signals obtained by our PSG system, we randomly select 30-seconds of raw physiological signals obtained by our PSG system and VOLUME 6, 2018 411 C.-T. Lin et al.: IoT-Based Wireless PSG Intelligent System for Sleep Monitoring FIGURE 16. A comparison of 30-second raw data (EEG C4-M1) and their correlation every 1 second. FIGURE 17. Hypnograms of the two sets of records (subject 3). the Alice 5 Diagnostic Sleep system, and compared both. The two sets of physiological signals looked very sim- ilar and displayed the same obvious features. Therefore, a more quantitative comparison was then performed by using cross-correlation and the correlation coef cients function in MATLAB to obtain the linear correlation of the two sets of physiological signals. Fig. 16 compares 30-second raw phys- iological signal data in the time domain and their correlation in every 1 second in EEG-C4M1. From the above results, we found that the physiological signals obtained by our PSG system and the reference system in the time domain were highly similar. Therefore, our PSG system can be seen as having a high level of reliability. The hypnogram built on the two sets of records is shown in Fig. 17. We found that the night patterns evaluated by the expert clinician for the two sets of data were similar. A comprehensive view of subjects 1 and 3 at the beginning of the recorded time were different, but this did not affect the trend of the whole sleep architecture. The major difference in the interpretation between the reference system and our PSG system occurred in the case of subject 2. This is because the electrode lead fell off at 5 o clock. In the case of subject 3, the sleep stage interpretation of our PSG system was the most similar to that of the reference system. FIGURE 18. Percentage of each sleep stage overnight. TABLE 4. Relative errors on time spent in each sleep stage. We rejected the segment of subject 1 and subject 2 records obtained by the reference system, which was prior to the beginning of this experiment for the subject 1, and the sub- ject 2 records obtained by the proposed PSG system, which was after the occurrence of falling off electrode lead. Then, we observed the time duration of each sleep stage which cumulated sleep hours for three subjects as shown in Table 4, and the percentages of each sleep stage overnight in two sys- tems (Fig. 18). In view of the above, we found that the dura- tion of Stage W, Stage N1 and Stage REM in two systems had similar interpretation, but had a gap between Stage N2 and Stage N3. According to the explanation of the clinical expert, the proportion of combining the duration of Stage N2 and Stage N3 to the whole duration of the two systems was the same. Thus, Stage N2 may be interpreted as Stage N3 if some segments of the physiology signals were extremely similar. This caused the difference in the interpretation between the two systems for Stage N2 and Stage N3. VI. CONCLUSION This study presented the design and implementation of a battery-powered and ambulatory biopotential acquisition unit and a friendly monitoring / recording interface for sleep monitoring at home. Compared to the standard PSG-Alice 5 R Diagnostic Sleep System, our proposed system per- formed similarly in relation to performance and quality. This experiment is based on the IoT based infrastructure. The PSG recording program in the personal computer was developed in JAVA and can run on any Java virtual machine, regardless of computer architecture. In combination with Bluetooth R wireless technology, our design can be easily 412 VOLUME 6, 2018 C.-T. Lin et al.: IoT-Based Wireless PSG Intelligent System for Sleep Monitoring used anywhere at home and will not be restricted to a spe- ci c activity area. Moreover, compared to other portable PSG systems, our proposed PSG system comprises a two- channel EEG, and therefore can offer more information to t the requirements of accurate analysis and diagnosis. In our PSG system, the portable biopotential acquisition unit can continually work for about 16 to 20 hours with a 3.7V lithium battery without loss data. Therefore, it capably supports full- night sleep monitoring. In conclusion, the aim of our proposed PSG system is not to replace the standard 16-channel PSG system, but to collect important physiological information (EEG x 2, EOG x2, EMG x 1, ECG x1, and air ow) for sleep analysis. By using our PSG system, the cost of an attended in-laboratory PSG experiment for OSA diagnosis can be effectively reduced. Furthermore, our system offers the comfort and convenience of sleeping in the patient s own bed, and therefore may record more natural information which more accurately re ects the patient s sleeping behavior. ACKNOWLEDGEMENTS This work is part of the Master by Research thesis work of Chia-Hsin Chung at National Chiao Tung Univer- sity (NCTU), Hsinchu, Taiwan, R.O.C. under supervision of Professor Chin-Teng Lin. The digital version of the thesis is available online at NCTU digital library, Taiwan [53]. REFERENCES [1] S. Yan-Fanga and W. Yu-Ping, Sleep-disordered breathing: Impact on functional outcome of ischemic stroke patients, Sleep Med., vol. 10, no. 7, pp. 717 719, 2009. [2] E. O. Bixler et al., Blood pressure associated with sleep-disordered breathing in a population sample of children, Hypertension, vol. 52, no. 5, pp. 841 846, 2008. [3] R. S. T. Leung, Sleep-disordered breathing: Autonomic mechanisms and arrhythmias, Progr. Cardiovascular Diseases, vol. 51, no. 4, pp. 324 338, 2009. [4] D. S. Silverberg, A. Iaina, and A. Oksenberg, Treating obstructive sleep apnea improves essential hypertension and quality of life, Amer. Family Phys., vol. 65, pp. 229 236, Jan. 2002. [5] J. Ter n-Santos, A. Jimenez-Gomez, and J. Cordero-Guevara, The asso- ciation between sleep apnea and the risk of traf c accidents, New Eng. J. Med., vol. 340, pp. 847 851, Mar. 1999. [6] A. T. Society, Cardiorespiratory sleep studies in children, Amer. J. Respiratory Crit. Care Med., vol. 160, no. 4, pp. 1381 1387, 1999. [7] T. Young, M. Palta, J. Dempsey, J. Skatrud, S. Weber, and S. Badr, The occurrence of sleep-disordered breathing among middle-aged adults, New Eng. J. Med., vol. 328, pp. 1230 1235, Apr. 1993. [8] R. Ferber et al., Portable recording in the assessment of obstructive sleep apnea. ASDA standards of practice, Sleep, vol. 17, no. 4, pp. 378 392, 1994. [9] R. Ferber et al., Portable recording in the assessment of obstructive sleep apnea, Sleep, vol. 17, no. 4, pp. 378 392, 1994. [10] Philips Respironics Inc. [Online]. Available: http://alice5. respironics.com/ [11] The AASM Manual for the Scoring of Sleep and Associated Events: Rules, Terminology and Technical Speci cations, Amer. Acad. Sleep Med., Westchester, IL, USA, 2007. [12] C. Iber et al., Polysomnography performed in the unattended home versus the attended laboratory setting Sleep Heart Health Study methodology, Sleep, vol. 27, no. 3, pp. 536 540, 2004. [13] K. Dingli et al., Evaluation of a portable device for diagnosing the sleep apnoea/hypopnoea syndrome, Eur. Respiratory J., vol. 21, no. 2, pp. 253 259, 2003. [14] S. D. Pittman et al., Using a wrist-worn device based on peripheral arterial tonometry to diagnose obstructive sleep apnea: In-laboratory and ambulatory validation, Sleep, vol. 27, no. 5, pp. 923 933, 2004. [15] C. A. Chesson, Jr., et al., Practice parameters for the use of portable monitoring devices in the investigation of suspected obstructive sleep apnea in adults, Sleep, vol. 26, no. 7, pp. 907 913, 2003. [16] K. P. Strohl, When, where and how to test for sleep apnea, Sleep, vol. 23, no. 2, pp. 99 101, 2000. [17] A. T. Whittle, S. P. Finch, I. L. Mortimore, T. W. MacKay, and N. J. Douglas, Use of home sleep studies for diagnosis of the sleep apnoea/hypopnoea syndrome, Thorax, vol. 52, no. 12, pp. 1068 1073, 1997. [18] F. G. Issa, D. Morrison, E. Hadjuk, A. Iyer, T. Feroah, and J. E. Remmers, Digital monitoring of sleep-disordered breathing using snoring sound and arterial oxygen saturation, Amer. Rev. Respiratory Disease, vol. 148, pp. 1023 1029, Oct. 1993. [19] D. P. White, T. J. Gibb, J. M. Wall, and P. R. Westbrook, Assessment of accuracy and analysis time of a novel device to monitor sleep and breathing in the home, Sleep, vol. 18, no. 2, pp. 115 126, 1995. [20] J. A. Reichert, D. A. Bloch, E. Cundiff, and B. A. Votteri, Comparison of the NovaSom QSG, a new sleep apnea home-diagnostic system, and polysomnography, Sleep Med., vol. 4, no. 4, pp. 213 218, 2003. [21] P. Varady, T. Micsik, S. Benedek, and Z. Benyo, A novel method for the detection of apnea and hypopnea events in respiration signals, IEEE Trans. Biomed. Eng., vol. 49, no. 9, pp. 936 942, Sep. 2002. [22] P. R. Westbrook et al., Description and validation of the apnea risk evaluation system: A novel method to diagnose sleep apnea-hypopnea in the home, Chest, vol. 128, no. 4, pp. 2166 2175, 2005. [23] W. W. Flemons et al., Home diagnosis of sleep apnea: A systematic review of the literature, Chest, vol. 124, no. 4, pp. 1543 1579, 2003. [24] W. W. Flemons, N. J. Douglas, S. T. Kuna, D. O. Rodenstein, and J. Wheatley, Access to diagnosis and treatment of patients with suspected sleep apnea, Amer. J. Respiratory Crit. Care Med., vol. 169, no. 6, pp. 668 672, 2004. [25] S. D. Ross, I. E. Allen, K. J. Harrison, M. Kvasz, J. Connelly, and I. A. Sheinhait, Systematic Review of the Literature Regarding the Diagno- sis of Sleep Apnea. Evidence Report/Technology Assessment. Washington, DC, USA: AHCPR, 1999. [26] T. Young, L. Evans, L. Finn, and M. Palta, Estimation of the clinically diagnosed proportion of sleep apnea syndrome in middle-aged men and women, Sleep, vol. 20, no. 9, pp. 705 706, 1997. [27] F. Rahaghi and R. C. Basner, Delayed diagnosis of obstructive sleep apnea: Don t ask, don t tell, Sleep Breath, vol. 3, no. 4, pp. 119 124, 1999. [28] B. Kemp, A. Varri, A. C. Rosa, K. D. Nielsen, and J. Gade, A sim- ple format for exchange of digitized polygraphic recordings, Electroen- cephalogr. Clin. Neurophysiol., vol. 82, no. 5, pp. 391 393, 1992. [29] J. G. Webster, Medical Instrumentation: Application and Design, 3rd ed. Hoboken, NJ, USA: Wiley, 1998. [30] UW Computing & Communications. Accessed: Sep. 2007. [Online]. Avail- able: http://faculty.washington.edu/chudler/1020.html [31] R. B. Berry and M. H. Wagner, Sleep Medicine Pearls. Amsterdam, The Netherlands: Elsevier, 2003. [32] M. H. Silber, The visual scoring of sleep in adults, J. Clin. Sleep Med., vol. 3, no. 2, pp. 121 131, 2007. [33] A. L. Loomis, E. N. Harvey, and G. A. Hobart, Cerebral states during sleep, as studied by human brain potentials, J. Exp. Psychol., vol. 21, no. 2, pp. 127 144, 1937. [34] W. Dement and N. Kleitman, Cyclic variations in EEG during sleep and their relation to eye movements, body motility, and dreaming, Electroen- cephalogr. Clin. Neurophysiol., vol. 9, no. 4, pp. 673 690, 1957. [35] A. Rechtschaffen and A. Kales, Eds., A Manual of Standardized Terminol- ogy, Techniques and Scoring System for Sleep Stages of Human Subjects. Washington, DC, USA: Public Health Service, U.S. Government Printing Of ce, 1968. [36] Stages of Sleep, Psychology World, 2008. [Online]. Available: https://www.ncbi.nlm.nih.gov/pubmed/16676789 [37] H. Schulz, Rethinking sleep analysis. Comment on the AASM manual for the scoring of sleep and associated events, J. Clin. Sleep Med., vol. 4, no. 2, pp. 99 103, 2008. [38] J. M. R. Delgado and W. L. Nastuk, Electrodes for extracellular record- ing and stimulation, in Physical Techniques in Biological Research. New York, NY, USA: Academic, 1964. VOLUME 6, 2018 413 C.-T. Lin et al.: IoT-Based Wireless PSG Intelligent System for Sleep Monitoring [39] Texas Instrument. MSP430 Manual. [Online]. Available: http://focus. ti.com/lit/ug/slau049f/slau049f.pdf [40] CSR Inc. EDFbrowser Software. [Online]. Available: http://www. csrsupport.com/BC4Ext [41] Psychology: An Introduction. Accessed: Sep. 2007. [Online]. Available: http://www.intropsych.com/ch03_states/stages_of_sleep.html [42] EDFbrowser Software. Accessed: Jan. 2008. [Online]. Available: http://www.teuniz.net/edfbrowser/ [43] Quiet Sleep Inc. [Online]. Available: http://www.quietsleep. com/diagnosticdevices/polysomnography.cfm [44] Home Sleep Diagnostics LTD. Accessed: Apr. 2008. [Online]. Available: http://homesleepdiagnostics.net/apnea.php [45] Sleep Disorder Breathing. Accessed: Dec. 2008. [Online]. Available: http://sleepandtmdcenter.com/Sleep_Disorder_Breathing.html [46] Electroencephalography. Accessed: Mar. 2009. [Online]. Available: http://en.wikipedia.org/wiki/Electroencephalography [47] T. S. Johnson et al., Sleep Apnea The Phantom of the Night: Overcome Sleep Apnea Syndrome and Snoring. Cambridge, MA, USA: New Tech- nology Publishing, 1995. [48] D. Puthal, X. Wu, S. Nepal, R. Ranjan, and J. Chen, SEEN: A selective encryption method to ensure con dentiality for big sensing data streams, IEEE Trans. Big Data, to be published, doi:10.1109/TBDATA.2017.2702172. [49] D. Puthal, S. Nepal, R. Ranjan, and J. Chen, DLSeF: A dynamic key- length-based ef cient real-time security veri cation model for big data stream, ACM Trans. Embedded Comput. Syst., vol. 16, no. 2, p. 51, 2017. [50] D. Puthal, S. Nepal, R. Ranjan, and J. Chen, A secure big data stream analytics framework for disaster management on the cloud, in Proc. 18th IEEE Int. Conf. High Perform. Comput. Commun. (HPCC), Dec. 2016, pp. 1218 1225. [51] D. Puthal, S. Nepal, R. Ranjan, and J. Chen, Threats to networking cloud and edge datacenters in the Internet of things, IEEE Cloud Comput., vol. 3, no. 3, pp. 64 71, May/Jun. 2016. [52] S. Sharma, D. Puthal, S. Tazeen, M. Prasad, and A. Y. Zomaya, MSGR: A mode-switched grid-based sustainable routing protocol for wireless sensor networks, IEEE Access, vol. 5, pp. 19864 19875, 2017, doi:10.1109/ACCESS.2017.2746676. [53] C.-H. Chung, The development of wireless polysomnography system for sleep monitoring at home, Ph.D. dissertation, Nat. Chiao Tung Univ., Hsinchu, Taiwan, 2009. [Online]. Available: https://ir.nctu.edu.tw/bitstream/11536/43442/1/563501.pdf CHIN-TENG LIN (F 05) received the B.S. degree from National Chiao- Tung University (NCTU), Taiwan, in 1986, and the master s and Ph.D. degree in electrical engineering from Purdue University, USA, in 1989 and 1992, respectively. He is currently a Chair Professor with the Faculty of Engineering and Information Technology, University of Technology Sydney, a Chair Professor of electrical and computer engineering, NCTU, Interna- tional Faculty of the University of California at San Diego, and holds a Honorary Professorship with the University of Nottingham. He was elevated International Fuzzy Systems Association Fellow in 2012. He also served on the Board of Governors with IEEE Circuits and Systems (CAS) Society from 2005 to 2008, the IEEE Systems, Man, Cybernetics Society from 2003 to 2005, the IEEE Computational Intelligence Society (CIS) from 2008 to 2010, and Chair of the IEEE Taipei Section from 2009 to 2010. He is a Distinguished Lecturer of the IEEE CAS Society from 2003 to 2005, and CIS Society from 2015 to 2017. He served as a Deputy Editor-in-Chief of the IEEE TRANSACTIONS ON CIRCUITS AND SYSTEMS II from 2006 to 2008. He has been Editor-in-Chief of the IEEE TRANSACTIONS ON FUZZY SYSTEMS since 2011. He was the Program Chair of the IEEE International Conference on Systems, Man, and Cybernetics in 2005 and the General Chair of the 2011 IEEE International Conference on Fuzzy Systems. He co-authored Neural Fuzzy Systems (Prentice-Hall), and authored Neural Fuzzy Control Systems with Structure and Parameter Learning (World Scienti c). He has authored over 200 journal papers (Total Citation: 20,155, H-index: 53, and i10-index: 373) in the areas of neural networks, fuzzy systems, multime- dia hardware/software, and cognitive neuro-engineering, including approxi- mately 101 IEEE journal papers. MUKESH PRASAD received the master s degree in computer application from Jawaharlal Nehru University, New Delhi, India, in 2009, and the Ph.D. degree in computer science from National Chiao Tung University, Hsinchu, Taiwan, in 2015. He is currently a Lecturer with the School of Software, Uni- versity of Technology Sydney, Australia. He has authored papers in interna- tional journal and conferences, including IEEE transactions, ACM, Elsevier, and Springer. His current research interests include machine learning, pattern recognition, fuzzy systems, neural networks, arti cial intelligence, and brain computer interface. CHIA-HSIN CHUNG received the master s degree from the Institute of Computer Science and Engineering, National Chiao Tung University, Hsinchu, Taiwan. Her research interests include signal processing, brain computer interface, EEG analysis, and hardware design. DEEPAK PUTHAL received the Ph.D. degree in computer and information systems from UTS, Australia. He is a Lecturer (Assistant Professor) with the School of Computing and Communications, University of Technology Syd- ney (UTS), Australia. He has published in several international conferences and journals, including IEEE and ACM transactions. His research interests include cyber security, Internet of Things, distributed computing, and big data analytics. He is an Associate Editor of the IEEE Consumer Electronics Magazine and the KSII Transactions on Internet and Information Systems. He also served as a Co-Guest Editor of several reputed international journals including the Concurrency and Computation: Practice and Experience, Wireless Communications and Mobile Computing, and the IEEE Consumer Electronics Magazine. HESHAM EL-SAYED is an Associate Professor with the College of Infor- mation Technology, United Arab Emirates University. His broad research interests span the areas of mobile and wireless networks, Internet of Things, trust management, intelligent transportation systems and vehicular ad-hoc networks. SHARMI SANKAR received the dual master s degree in computer science and computer science engineering. She is currently with the Ministry of Higher Education, Sultanate of Oman. She has 16 years of experience in academics. Her domain interests fall under the categories of algorith- mic optimization, machine learning, network traf c study, prediction, QoS enhancement procedure, and big data management. YU-KAI WANG is currently a Research Associate with the School of Software, University of Technology Sydney, Australia. His current research interests include bio-medical engineering, brain computer interface, and signal processing. JAGENDRA SINGH received the Ph.D. degree in computer science from Jawaharlal Nehru University, New Delhi, India. He is an Assistant Profes- sor with the Department of Computer Science, Indraprastha Engineering College, Ghaziabad, India. He has published several research papers in inter- national conferences and journals of repute. His research interest is in cloud computing, natural language processing, data/text mining and information security. ARUN KUMAR SANGAIAH is currently an Associate Professor with the School of Computer Science and Engineering, VIT University, India. His area of interest includes software engineering, computational intelligence, wireless networks, bio-informatics, and embedded systems. He has authored over 100 publications in different journals and conferences of national and international repute. His current research work includes global soft- ware development, wireless ad hoc and sensor networks, machine learning, cognitive networks, and advances in mobile computing and communications. 414 VOLUME 6, 2018